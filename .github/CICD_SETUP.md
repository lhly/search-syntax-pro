# CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜ SearchSyntax Pro é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒæµç¨‹ã€‚

## ğŸ“‹ æ¦‚è§ˆ

- **CI/CD å¹³å°**ï¼šGitHub Actions
- **å·¥ä½œæµæ–‡ä»¶**ï¼š`.github/workflows/release.yml`
- **å½“å‰ç‰ˆæœ¬**ï¼šv1.5.0
- **è§¦å‘æ–¹å¼**ï¼šTag æ¨é€ã€Main åˆ†æ”¯æ¨é€ã€Pull Request

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆå®Œæ•´æµç¨‹ï¼‰

```bash
# 1. ç¡®ä¿åœ¨ main åˆ†æ”¯ä¸”å·¥ä½œåŒºå¹²å‡€
git checkout main
git pull origin main

# 2. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆä¼šè‡ªåŠ¨åˆ›å»º commit å’Œ tagï¼‰
npm version patch   # 1.5.0 -> 1.5.1 (bug ä¿®å¤)
npm version minor   # 1.5.0 -> 1.6.0 (æ–°åŠŸèƒ½)
npm version major   # 1.5.0 -> 2.0.0 (ç ´åæ€§æ›´æ–°)

# 3. æ¨é€ä»£ç å’Œæ ‡ç­¾åˆ° GitHub
git push origin main
git push origin --tags

# 4. ç›‘æ§ GitHub Actions æ„å»ºçŠ¶æ€
# è®¿é—®ï¼šhttps://github.com/lhly/search-syntax-pro/actions

# 5. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦ 3-5 åˆ†é’Ÿï¼‰

# 6. å®¡æŸ¥å¹¶å‘å¸ƒ Release
# è®¿é—®ï¼šhttps://github.com/lhly/search-syntax-pro/releases
# - æ£€æŸ¥ ZIP æ–‡ä»¶å®Œæ•´æ€§
# - è¡¥å……å‘å¸ƒè¯´æ˜ï¼ˆå¯é€‰ï¼‰
# - ç‚¹å‡» "Publish release" å‘å¸ƒ

# 7. ä¸Šä¼ åˆ° Chrome Web Store
# - ä¸‹è½½ ssp-v{version}.zip
# - ç™»å½• Chrome Web Store Developer Console
# - ä¸Šä¼ æ–°ç‰ˆæœ¬å¹¶æäº¤å®¡æ ¸
```

## ğŸ”§ å·¥ä½œæµè¯´æ˜

### è§¦å‘æ¡ä»¶

| è§¦å‘äº‹ä»¶ | æ¡ä»¶ | æ‰§è¡Œå†…å®¹ |
|---------|------|---------|
| **Tag æ¨é€** | `v*.*.*` | å®Œæ•´æµç¨‹ï¼šæ„å»º â†’ æµ‹è¯• â†’ æ‰“åŒ… â†’ å‘å¸ƒ |
| **Main æ¨é€** | `push to main` | CI éªŒè¯ï¼šæ„å»º â†’ æµ‹è¯•ï¼ˆä¸å‘å¸ƒï¼‰ |
| **Pull Request** | `PR to main` | è´¨é‡æ£€æŸ¥ï¼šæ„å»º â†’ æµ‹è¯• |

### å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GitHub Actions Pipeline             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Job 1: build-and-test                             â”‚
â”‚  â”œâ”€ Checkout code                                   â”‚
â”‚  â”œâ”€ Setup Node.js 18.x                             â”‚
â”‚  â”œâ”€ Cache dependencies                              â”‚
â”‚  â”œâ”€ Install dependencies (npm ci)                   â”‚
â”‚  â”œâ”€ Type check (tsc --noEmit)                      â”‚
â”‚  â”œâ”€ Lint (eslint)                                   â”‚
â”‚  â”œâ”€ Run tests (jest)                                â”‚
â”‚  â”œâ”€ Verify version consistency âœ…                   â”‚
â”‚  â”œâ”€ Build extension (npm run build)                â”‚
â”‚  â””â”€ Upload build artifacts                          â”‚
â”‚                                                      â”‚
â”‚  Job 2: package (éœ€è¦ Job 1 æˆåŠŸ)                  â”‚
â”‚  â”œâ”€ Download build artifacts                        â”‚
â”‚  â”œâ”€ Create ZIP package                              â”‚
â”‚  â””â”€ Upload ZIP artifact                             â”‚
â”‚                                                      â”‚
â”‚  Job 3: release (ä»… Tag è§¦å‘ï¼Œéœ€è¦ Job 2 æˆåŠŸ)    â”‚
â”‚  â”œâ”€ Download ZIP package                            â”‚
â”‚  â”œâ”€ Extract version info                            â”‚
â”‚  â”œâ”€ Generate changelog                              â”‚
â”‚  â””â”€ Create GitHub Release (è‰ç¨¿) ğŸ“¦                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ„å»ºäº§ç‰©

### Artifactsï¼ˆä¿ç•™ 90 å¤©ï¼‰

- **dist-{sha}**ï¼šæ„å»ºåçš„æ‰©å±•æ–‡ä»¶
- **extension-package-{sha}**ï¼šæ‰“åŒ…å¥½çš„ ZIP æ–‡ä»¶

### GitHub Releaseï¼ˆæ°¸ä¹…ä¿å­˜ï¼‰

- **ssp-v{version}.zip**ï¼šå¯ç›´æ¥å®‰è£…çš„ Chrome æ‰©å±•
- è‡ªåŠ¨ç”Ÿæˆçš„æ›´æ–°æ—¥å¿—
- æ„å»ºä¿¡æ¯å’ŒæŠ€æœ¯ç»†èŠ‚

## âœ… ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥

é¡¹ç›®åŒ…å«è‡ªåŠ¨åŒ–è„šæœ¬ç¡®ä¿ç‰ˆæœ¬å·åŒæ­¥ï¼š

```bash
# æ‰‹åŠ¨æ£€æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§
npm run check-version

# æˆ–ç›´æ¥è¿è¡Œè„šæœ¬
node scripts/check-version.js
```

æ£€æŸ¥å†…å®¹ï¼š
- âœ… `package.json` çš„ `version` å­—æ®µ
- âœ… `public/manifest.json` çš„ `version` å­—æ®µ
- âœ… ç‰ˆæœ¬å·æ ¼å¼éªŒè¯ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰

### ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼š

```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.è¡¥ä¸ç‰ˆæœ¬å·[-é¢„å‘å¸ƒæ ‡è¯†]

ä¾‹å¦‚ï¼š
- 1.5.0        (ç¨³å®šç‰ˆæœ¬)
- 1.5.1-beta.1 (é¢„å‘å¸ƒç‰ˆæœ¬)
- 2.0.0-rc.1   (å€™é€‰ç‰ˆæœ¬)
```

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

### æµ‹è¯• CI æµç¨‹

åœ¨æ¨é€åˆ° GitHub ä¹‹å‰ï¼Œå¯ä»¥æœ¬åœ°éªŒè¯ï¼š

```bash
# 1. ç±»å‹æ£€æŸ¥
npm run type-check

# 2. ä»£ç æ£€æŸ¥
npm run lint

# 3. è¿è¡Œæµ‹è¯•
npm run test

# 4. ç‰ˆæœ¬ä¸€è‡´æ€§
npm run check-version

# 5. æ„å»ºé¡¹ç›®
npm run build

# 6. æ‰“åŒ…æ‰©å±•
npm run package
```

### è°ƒè¯•å·¥ä½œæµ

å¦‚æœ GitHub Actions æ„å»ºå¤±è´¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   - è®¿é—® Actions æ ‡ç­¾é¡µ
   - ç‚¹å‡»å¤±è´¥çš„å·¥ä½œæµ
   - æŸ¥çœ‹å…·ä½“å¤±è´¥çš„æ­¥éª¤å’Œé”™è¯¯ä¿¡æ¯

2. **å¸¸è§é—®é¢˜**ï¼š
   - ç‰ˆæœ¬å·ä¸ä¸€è‡´ â†’ è¿è¡Œ `npm run check-version`
   - æ„å»ºå¤±è´¥ â†’ æœ¬åœ°è¿è¡Œ `npm run build` æ£€æŸ¥
   - æµ‹è¯•å¤±è´¥ â†’ æœ¬åœ°è¿è¡Œ `npm test` ä¿®å¤
   - ç±»å‹é”™è¯¯ â†’ è¿è¡Œ `npm run type-check`

3. **é‡æ–°è§¦å‘**ï¼š
   - ä¿®å¤é—®é¢˜åé‡æ–°æ¨é€
   - æˆ–åœ¨ Actions é¡µé¢ç‚¹å‡» "Re-run jobs"

## ğŸ“ æœ€ä½³å®è·µ

### å‘å¸ƒæ£€æŸ¥æ¸…å•

å‘å¸ƒå‰ç¡®è®¤ï¼š

- [ ] ä»£ç å·²åˆå¹¶åˆ° main åˆ†æ”¯
- [ ] æœ¬åœ°æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] æ›´æ–°äº† CHANGELOG æˆ–æäº¤ä¿¡æ¯æ¸…æ™°
- [ ] ç‰ˆæœ¬å·ç¬¦åˆè¯­ä¹‰åŒ–è§„èŒƒ
- [ ] æ²¡æœ‰æœªæäº¤çš„æ›´æ”¹

### ç‰ˆæœ¬æ›´æ–°ç­–ç•¥

- **è¡¥ä¸ç‰ˆæœ¬**ï¼ˆpatchï¼‰ï¼šBug ä¿®å¤ã€æ–‡æ¡£æ›´æ–°ã€å°ä¼˜åŒ–
- **æ¬¡ç‰ˆæœ¬**ï¼ˆminorï¼‰ï¼šæ–°åŠŸèƒ½ã€åŠŸèƒ½å¢å¼ºã€éç ´åæ€§æ›´æ”¹
- **ä¸»ç‰ˆæœ¬**ï¼ˆmajorï¼‰ï¼šç ´åæ€§æ›´æ”¹ã€é‡å¤§æ¶æ„è°ƒæ•´

### Git æ ‡ç­¾è§„èŒƒ

```bash
# âœ… æ­£ç¡®çš„æ ‡ç­¾æ ¼å¼
git tag v1.5.0
git tag v2.0.0-beta.1

# âŒ é”™è¯¯çš„æ ‡ç­¾æ ¼å¼
git tag 1.5.0      # ç¼ºå°‘ 'v' å‰ç¼€
git tag version1.5 # ä¸ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬
```

## ğŸ”’ å®‰å…¨æ€§

### æƒé™é…ç½®

å·¥ä½œæµä½¿ç”¨çš„æƒé™ï¼š

- `contents: write` - åˆ›å»º Release å’Œä¸Šä¼ æ–‡ä»¶
- `pull-requests: read` - è¯»å– PR ä¿¡æ¯

### Token ä½¿ç”¨

- ä½¿ç”¨ GitHub è‡ªåŠ¨æä¾›çš„ `GITHUB_TOKEN`
- æ— éœ€æ‰‹åŠ¨é…ç½®å¯†é’¥
- Token æƒé™é™å®šåœ¨å½“å‰ä»“åº“

## ğŸš¨ æ•…éšœæ’æŸ¥

### æ„å»ºå¤±è´¥

**é—®é¢˜**ï¼šæ„å»ºå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸º "dist directory not found"

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ dist ç›®å½•æ˜¯å¦è¢« gitignore
# ç¡®ä¿æ„å»ºè„šæœ¬æ­£ç¡®æ‰§è¡Œ
npm run build
ls -la dist/
```

### ç‰ˆæœ¬ä¸ä¸€è‡´

**é—®é¢˜**ï¼šCI æŠ¥é”™ "ç‰ˆæœ¬å·ä¸ä¸€è‡´"

**è§£å†³**ï¼š
```bash
# è¿è¡Œç‰ˆæœ¬æ£€æŸ¥è„šæœ¬
npm run check-version

# æ‰‹åŠ¨åŒæ­¥ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç¼–è¾‘ public/manifest.jsonï¼Œå°† version æ”¹ä¸ºä¸ package.json ä¸€è‡´
```

### Release åˆ›å»ºå¤±è´¥

**é—®é¢˜**ï¼šTag æ¨é€åæ²¡æœ‰åˆ›å»º Release

**è§£å†³**ï¼š
1. æ£€æŸ¥ Tag æ ¼å¼æ˜¯å¦ä¸º `v*.*.*`
2. æŸ¥çœ‹ Actions æ—¥å¿—ç¡®è®¤æƒé™é—®é¢˜
3. ç¡®ä¿ `package` Job æˆåŠŸå®Œæˆ

## ğŸ“š å‚è€ƒèµ„æº

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)
- [Chrome æ‰©å±•å‘å¸ƒæŒ‡å—](https://developer.chrome.com/docs/webstore/publish/)
- [é¡¹ç›® README](../README.md)

## ğŸ†˜ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹ [GitHub Issues](https://github.com/lhly/search-syntax-pro/issues)
2. æŸ¥çœ‹å·¥ä½œæµæ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯
3. æäº¤æ–° Issue å¹¶é™„ä¸Šé”™è¯¯æ—¥å¿—

---

**æœ€åæ›´æ–°**ï¼š2025-11-10
**ç»´æŠ¤è€…**ï¼šSearchSyntax Pro Team
