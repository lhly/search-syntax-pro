<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitter é›†æˆæµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 2rem;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 30px;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .test-section h2 {
      color: #495057;
      font-size: 1.25rem;
      margin-bottom: 15px;
    }

    .test-item {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .test-item h3 {
      color: #333;
      font-size: 1rem;
      margin-bottom: 8px;
    }

    .test-result {
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      color: #495057;
      background: #f1f3f5;
      padding: 10px;
      border-radius: 6px;
      margin-top: 8px;
      word-break: break-all;
    }

    .pass {
      color: #28a745;
      font-weight: 600;
    }

    .fail {
      color: #dc3545;
      font-weight: 600;
    }

    .info {
      background: #e7f3ff;
      border-left-color: #0066cc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      color: #004085;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Twitter é›†æˆæµ‹è¯•</h1>
    <div class="status success">æ–¹æ¡ˆ A å®æ–½éªŒè¯</div>

    <div class="info">
      <strong>ğŸ“‹ æµ‹è¯•ç›®æ ‡ï¼š</strong> éªŒè¯ Twitter æœç´¢å¼•æ“é€‚é…å™¨çš„å®Œæ•´åŠŸèƒ½
      <br><br>
      <strong>ğŸ”§ æµ‹è¯•èŒƒå›´ï¼š</strong>
      <ul style="margin-left: 20px; margin-top: 10px;">
        <li>ç±»å‹ç³»ç»Ÿæ‰©å±•</li>
        <li>é€‚é…å™¨å·¥å‚æ³¨å†Œ</li>
        <li>æŸ¥è¯¢æ„å»ºé€»è¾‘</li>
        <li>å‚æ•°éªŒè¯åŠŸèƒ½</li>
        <li>UI å›½é™…åŒ–æ”¯æŒ</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>âœ… æµ‹è¯•ç»“æœæ€»è§ˆ</h2>
      <div id="summary"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ“ è¯¦ç»†æµ‹è¯•é¡¹</h2>
      <div id="tests"></div>
    </div>

    <button onclick="runTests()">ğŸš€ é‡æ–°è¿è¡Œæµ‹è¯•</button>
  </div>

  <script type="module">
    import { SearchAdapterFactory } from '../dist/assets/index.js'

    window.runTests = async function() {
      const testsDiv = document.getElementById('tests')
      const summaryDiv = document.getElementById('summary')
      testsDiv.innerHTML = ''

      let passCount = 0
      let failCount = 0
      const tests = []

      // æµ‹è¯• 1: ç±»å‹ç³»ç»Ÿæ”¯æŒ
      try {
        const supportedEngines = SearchAdapterFactory.getSupportedEngines()
        const hasTwitter = supportedEngines.includes('twitter')

        tests.push({
          name: 'ç±»å‹ç³»ç»Ÿ - Twitter å¼•æ“æ”¯æŒ',
          pass: hasTwitter,
          result: hasTwitter
            ? `âœ“ Twitter å·²æ·»åŠ åˆ°æ”¯æŒçš„å¼•æ“åˆ—è¡¨: ${supportedEngines.join(', ')}`
            : 'âœ— Twitter æœªåœ¨æ”¯æŒçš„å¼•æ“åˆ—è¡¨ä¸­'
        })

        if (hasTwitter) passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'ç±»å‹ç³»ç»Ÿ - Twitter å¼•æ“æ”¯æŒ',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æµ‹è¯• 2: é€‚é…å™¨å®ä¾‹åŒ–
      try {
        const adapter = SearchAdapterFactory.getAdapter('twitter')
        const name = adapter.getName()

        tests.push({
          name: 'é€‚é…å™¨å·¥å‚ - Twitter å®ä¾‹åŒ–',
          pass: name === 'X (Twitter)',
          result: name === 'X (Twitter)'
            ? `âœ“ é€‚é…å™¨åç§°æ­£ç¡®: ${name}`
            : `âœ— é€‚é…å™¨åç§°é”™è¯¯: ${name}`
        })

        if (name === 'X (Twitter)') passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'é€‚é…å™¨å·¥å‚ - Twitter å®ä¾‹åŒ–',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æµ‹è¯• 3: åŸºç¡€æŸ¥è¯¢æ„å»º
      try {
        const adapter = SearchAdapterFactory.getAdapter('twitter')
        const url = adapter.buildQuery({
          keyword: 'JavaScript',
          engine: 'twitter'
        })
        const hasKeyword = url.includes('JavaScript')
        const hasBaseUrl = url.includes('twitter.com/search')

        tests.push({
          name: 'æŸ¥è¯¢æ„å»º - åŸºç¡€å…³é”®è¯',
          pass: hasKeyword && hasBaseUrl,
          result: hasKeyword && hasBaseUrl
            ? `âœ“ URL æ„å»ºæ­£ç¡®: ${url}`
            : `âœ— URL æ„å»ºé”™è¯¯: ${url}`
        })

        if (hasKeyword && hasBaseUrl) passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'æŸ¥è¯¢æ„å»º - åŸºç¡€å…³é”®è¯',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æµ‹è¯• 4: Twitter ç‰¹å®šè¯­æ³•
      try {
        const adapter = SearchAdapterFactory.getAdapter('twitter')
        const url = adapter.buildQuery({
          keyword: 'AI news',
          engine: 'twitter',
          fromUser: '@elonmusk',
          minRetweets: 100,
          contentFilters: ['images']
        })
        const decodedUrl = decodeURIComponent(url)
        const hasFrom = decodedUrl.includes('from:elonmusk')
        const hasMinRetweets = decodedUrl.includes('min_retweets:100')
        const hasFilter = decodedUrl.includes('filter:images')

        tests.push({
          name: 'æŸ¥è¯¢æ„å»º - Twitter ä¸“å±è¯­æ³•',
          pass: hasFrom && hasMinRetweets && hasFilter,
          result: hasFrom && hasMinRetweets && hasFilter
            ? `âœ“ Twitter è¯­æ³•æ­£ç¡®: from:, min_retweets:, filter:`
            : `âœ— Twitter è¯­æ³•é”™è¯¯: ${decodedUrl}`
        })

        if (hasFrom && hasMinRetweets && hasFilter) passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'æŸ¥è¯¢æ„å»º - Twitter ä¸“å±è¯­æ³•',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æµ‹è¯• 5: å‚æ•°éªŒè¯
      try {
        const adapter = SearchAdapterFactory.getAdapter('twitter')
        const result = adapter.validateParams({
          keyword: 'test',
          engine: 'twitter',
          fromUser: '@valid_user',
          minRetweets: 10
        })

        tests.push({
          name: 'å‚æ•°éªŒè¯ - æœ‰æ•ˆå‚æ•°',
          pass: result.isValid,
          result: result.isValid
            ? `âœ“ éªŒè¯é€šè¿‡: æ— é”™è¯¯`
            : `âœ— éªŒè¯å¤±è´¥: ${result.errors.join(', ')}`
        })

        if (result.isValid) passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'å‚æ•°éªŒè¯ - æœ‰æ•ˆå‚æ•°',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æµ‹è¯• 6: è¯­æ³•æ”¯æŒæ£€æŸ¥
      try {
        const adapter = SearchAdapterFactory.getAdapter('twitter')
        const supportedSyntax = adapter.getSupportedSyntax()
        const hasFromUser = supportedSyntax.includes('from_user')
        const hasToUser = supportedSyntax.includes('to_user')
        const hasFilter = supportedSyntax.includes('filter')
        const hasMinRetweets = supportedSyntax.includes('min_retweets')

        const allSupported = hasFromUser && hasToUser && hasFilter && hasMinRetweets

        tests.push({
          name: 'è¯­æ³•æ”¯æŒ - Twitter ä¸“å±è¯­æ³•ç±»å‹',
          pass: allSupported,
          result: allSupported
            ? `âœ“ æ”¯æŒæ‰€æœ‰ Twitter è¯­æ³•: ${supportedSyntax.filter(s => s.includes('_')).join(', ')}`
            : `âœ— ç¼ºå°‘æŸäº› Twitter è¯­æ³•`
        })

        if (allSupported) passCount++
        else failCount++
      } catch (error) {
        tests.push({
          name: 'è¯­æ³•æ”¯æŒ - Twitter ä¸“å±è¯­æ³•ç±»å‹',
          pass: false,
          result: `âœ— é”™è¯¯: ${error.message}`
        })
        failCount++
      }

      // æ¸²æŸ“æµ‹è¯•ç»“æœ
      tests.forEach(test => {
        const testItem = document.createElement('div')
        testItem.className = 'test-item'
        testItem.innerHTML = `
          <h3>${test.pass ? 'âœ…' : 'âŒ'} ${test.name}</h3>
          <div class="test-result">${test.result}</div>
        `
        testsDiv.appendChild(testItem)
      })

      // æ¸²æŸ“æ€»è§ˆ
      const totalTests = passCount + failCount
      const passRate = totalTests > 0 ? ((passCount / totalTests) * 100).toFixed(1) : 0

      summaryDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2.5rem; color: #667eea; font-weight: 700;">${totalTests}</div>
            <div style="color: #6c757d; margin-top: 5px;">æ€»æµ‹è¯•æ•°</div>
          </div>
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2.5rem; color: #28a745; font-weight: 700;">${passCount}</div>
            <div style="color: #6c757d; margin-top: 5px;">é€šè¿‡</div>
          </div>
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2.5rem; color: #dc3545; font-weight: 700;">${failCount}</div>
            <div style="color: #6c757d; margin-top: 5px;">å¤±è´¥</div>
          </div>
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 2.5rem; color: ${passRate === '100.0' ? '#28a745' : '#ffc107'}; font-weight: 700;">${passRate}%</div>
            <div style="color: #6c757d; margin-top: 5px;">é€šè¿‡ç‡</div>
          </div>
        </div>
        ${passRate === '100.0' ? '<div style="margin-top: 20px; padding: 15px; background: #d4edda; color: #155724; border-radius: 8px; text-align: center; font-weight: 600;">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Twitter é›†æˆæˆåŠŸï¼</div>' : ''}
      `
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.addEventListener('load', runTests)
  </script>
</body>
</html>
